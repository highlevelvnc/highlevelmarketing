<!doctype html>
<html lang="pt-PT">
  <head>
    <meta charset="UTF-8" />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ✅ Google Fonts (SEM CLS / SEM @import) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- ✅ Preconnect / DNS Prefetch (melhora mobile) -->
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="preconnect" href="https://www.google-analytics.com" />
    <link rel="preconnect" href="https://connect.facebook.net" />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />
    <link rel="dns-prefetch" href="https://connect.facebook.net" />

    <!-- Primary Meta Tags -->
    <title>Agência de Marketing e Publicidade em Portugal | HighLevelMKT</title>
    <meta
      name="title"
      content="Agência de Marketing e Publicidade em Portugal | HighLevelMKT"
    />
    <meta
      name="description"
      content="Agência de marketing e publicidade em Portugal. Tráfego pago, Google Ads, Meta Ads e SEO para gerar mais clientes. Atendemos Lisboa, Cascais e todo o país."
    />
    <meta
      name="keywords"
      content="agência de marketing Portugal, agência de publicidade Portugal, marketing digital Portugal, marketing digital Lisboa, tráfego pago Portugal, Meta Ads Portugal, Google Ads Portugal, SEO Portugal"
    />
    <meta name="author" content="HighLevelMKT" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href="https://highlevelmkt.com/" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://highlevelmkt.com/" />
    <meta
      property="og:title"
      content="Agência de Marketing e Publicidade em Portugal | HighLevelMKT"
    />
    <meta
      property="og:description"
      content="Agência de marketing e publicidade em Portugal. Tráfego pago, Google Ads, Meta Ads e SEO para gerar mais clientes."
    />
    <meta property="og:image" content="https://highlevelmkt.com/og-image.jpg" />
    <meta property="og:locale" content="pt_PT" />
    <meta property="og:locale:alternate" content="en_US" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://highlevelmkt.com/" />
    <meta
      property="twitter:title"
      content="Agência de Marketing e Publicidade em Portugal | HighLevelMKT"
    />
    <meta
      property="twitter:description"
      content="Agência de marketing e publicidade em Portugal. Tráfego pago, Google Ads, Meta Ads e SEO para gerar mais clientes."
    />
    <meta
      property="twitter:image"
      content="https://highlevelmkt.com/og-image.jpg"
    />

    <!-- Schema.org - ProfessionalService -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "HighLevelMKT",
        "description": "Agência de marketing e publicidade especializada em performance, tráfego pago e geração de clientes em Portugal.",
        "url": "https://highlevelmkt.com/",
        "telephone": "+351934071660",
        "email": "contato@highlevelmkt.com",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Lisboa",
          "addressRegion": "Lisboa",
          "addressCountry": "PT"
        },
        "areaServed": {
          "@type": "Country",
          "name": "Portugal"
        },
        "priceRange": "€€",
        "openingHours": "Mo-Fr 09:00-18:00",
        "sameAs": [
          "https://linkedin.com/company/highlevelmkt",
          "https://instagram.com/highlevelmkt",
          "https://facebook.com/highlevelmkt"
        ]
      }
    </script>

    <!-- ✅ Meta Pixel Stub (fila) IMEDIATO — não perde cliques antes do load -->
    <script>
      (function () {
        // cria fbq imediatamente (sem carregar a lib)
        !(function (f, b, e, v, n, t, s) {
          if (f.fbq) return;
          n = f.fbq = function () {
            n.callMethod
              ? n.callMethod.apply(n, arguments)
              : n.queue.push(arguments);
          };
          if (!f._fbq) f._fbq = n;
          n.push = n;
          n.loaded = false;
          n.version = "2.0";
          n.queue = [];
        })(window, document, "script", "https://connect.facebook.net/en_US/fbevents.js");

        // init já aqui (leve)
        window.fbq("init", "4331967567089383");

        // helpers seguros
        window.__HLM = window.__HLM || {};
        window.__HLM.safeFbq = function () {
          if (typeof window.fbq === "function") {
            try {
              window.fbq.apply(null, arguments);
            } catch (e) {}
          }
        };
        window.__HLM.isOSPage = function () {
          return (window.location && window.location.pathname || "").startsWith("/os");
        };
      })();
    </script>
  </head>

  <body>
    <!-- Meta Pixel (noscript) -->
    <noscript>
      <img
        height="1"
        width="1"
        style="display:none"
        src="https://www.facebook.com/tr?id=4331967567089383&ev=PageView&noscript=1"
      />
    </noscript>

    <div id="root"></div>

    <!-- App -->
    <script type="module" src="/src/main.jsx"></script>

    <!-- ✅ Tracking carregando APÓS o load/idle (protege LCP/FCP/CLS) + EVENTOS -->
    <script>
      window.addEventListener("load", function () {
        function loadTrackingLibs() {
          // ---- Google Tag / GA4 (como você já tinha) ----
          var gtagScript = document.createElement("script");
          gtagScript.async = true;
          gtagScript.src = "https://www.googletagmanager.com/gtag/js?id=GT-NMDNDC9Q";
          document.head.appendChild(gtagScript);

          window.dataLayer = window.dataLayer || [];
          function gtag() {
            dataLayer.push(arguments);
          }
          window.gtag = gtag;

          gtag("js", new Date());
          gtag("config", "GT-NMDNDC9Q");
          gtag("config", "G-YQCBN4SH2K", { anonymize_ip: true });

          // ---- Meta Pixel library (carrega real) ----
          var fbScript = document.createElement("script");
          fbScript.async = true;
          fbScript.src = "https://connect.facebook.net/en_US/fbevents.js";
          document.head.appendChild(fbScript);

          // PageView sempre
          window.__HLM.safeFbq("track", "PageView");
        }

        // Carrega libs em idle para performance
        if ("requestIdleCallback" in window) {
          requestIdleCallback(loadTrackingLibs, { timeout: 2000 });
        } else {
          setTimeout(loadTrackingLibs, 1200);
        }

        // ----------------------------
        // EVENTOS DO MÉTODO (META)
        // ----------------------------

        // 1) Page view específica do OS (quando estiver em /os)
        (function fireOSPageViewOnce() {
          if (!window.__HLM.isOSPage()) return;

          // dispara assim que possível (entra na fila se a lib ainda não carregou)
          window.__HLM.safeFbq("track", "ViewContent", { content_name: "HLM Predictable Revenue OS" });
          window.__HLM.safeFbq("trackCustom", "OS_PageView", { path: window.location.pathname });
        })();

        // 2) Clique em WhatsApp + Schedule (Calendly) + cliques externos (exit)
        document.addEventListener("click", function (e) {
          var el = e.target;
          if (!el) return;

          // sobe até achar um link/botão clicável
          var a = el.closest ? el.closest("a,button") : null;
          if (!a) return;

          var href = (a.getAttribute && a.getAttribute("href")) || "";
          var text = (a.textContent || "").toLowerCase();

          var isOS = window.__HLM.isOSPage();

          // WhatsApp detect
          var isWhats =
            href.includes("wa.me") ||
            href.includes("whatsapp.com") ||
            href.includes("api.whatsapp.com") ||
            text.includes("whatsapp");

          if (isWhats) {
            window.__HLM.safeFbq("track", "Contact");
            window.__HLM.safeFbq("trackCustom", "OS_WhatsApp_Click", {
              path: window.location.pathname,
              href: href || null
            });
            return;
          }

          // Calendly / agendamento detect
          var isSchedule =
            href.toLowerCase().includes("calendly") ||
            text.includes("agendar") ||
            text.includes("avaliação estratégica") ||
            text.includes("avaliacao estrategica");

          // ⚠️ Para evitar falso positivo fora do OS, só dispara Schedule se estiver na página /os
          if (isOS && isSchedule) {
            window.__HLM.safeFbq("track", "Schedule");
            window.__HLM.safeFbq("trackCustom", "OS_Schedule_Click", {
              path: window.location.pathname,
              href: href || null,
              label: (a.textContent || "").trim().slice(0, 80)
            });
          }

          // Exit click (link externo) — só na página /os (opcional)
          if (isOS && href && /^https?:\/\//i.test(href)) {
            try {
              var url = new URL(href, window.location.origin);
              if (url.host && url.host !== window.location.host) {
                window.__HLM.safeFbq("trackCustom", "OS_Exit_Click", {
                  from: window.location.pathname,
                  to: url.host
                });
              }
            } catch (_) {}
          }
        }, true);

        // 3) Submit de formulário => Lead + custom OS_Lead (se estiver em /os)
        document.addEventListener("submit", function (e) {
          if (!e || !e.target) return;

          var isOS = window.__HLM.isOSPage();
          var form = e.target;

          // Dispara Lead para qualquer form (podes restringir depois se quiseres)
          window.__HLM.safeFbq("track", "Lead");

          if (isOS) {
            window.__HLM.safeFbq("trackCustom", "OS_Lead", {
              path: window.location.pathname,
              formId: form.id || null,
              formName: form.getAttribute("name") || null
            });
          }
        }, true);

        // 4) Scroll 50% (só na página /os)
        (function setupScrollDepth() {
          if (!window.__HLM.isOSPage()) return;

          var fired = false;
          function onScroll() {
            if (fired) return;
            var doc = document.documentElement;
            var scrollTop = window.pageYOffset || doc.scrollTop || 0;
            var height = (doc.scrollHeight || 0) - (window.innerHeight || 0);
            if (height <= 0) return;
            var pct = scrollTop / height;

            if (pct >= 0.5) {
              fired = true;
              window.__HLM.safeFbq("trackCustom", "OS_Scroll_50", {
                path: window.location.pathname
              });
              window.removeEventListener("scroll", onScroll, { passive: true });
            }
          }
          window.addEventListener("scroll", onScroll, { passive: true });
        })();

      });
    </script>
  </body>
</html>
